rm(list = ls())

library(fields)
library(GpGp)

m <- 30
k <- 1
scene_ID <- 1
use_snn_order <- 0
source("../utils/data_simulation.R")
# locs and GP realization over 100X100 grid --------------
locs_all <- matrix(NA, nrow = n + n_test, ncol = ncol(locs))
locs_all[ind_train, ] <- locs
locs_all[ind_test, ] <- locs_test
y_true <- read.table(paste0("samples/sim_data_scene", scene_ID, "_true.csv"),
  header = F, row.names = NULL
)[, 1]
cov_func <- GpGp::matern15_isotropic
cov_parms <- c(1.0, 0.03, 0.0001)
cov_name <- "matern15_isotropic"
covmat <- cov_func(cov_parms, locs_all)
cens_lb <- rep(-Inf, n + n_test)
cens_ub <- rep(1, n + n_test)
mask_cens <- y_true < cens_ub
y_obs <- y_true
y_obs[mask_cens] <- NA
# sample using SNN ----------------
y_SNN <- nntmvn::rptmvn(y_obs, cens_lb, cens_ub, mask_cens,
  m = m, covmat = covmat, locs = locs_all,
  ordering = use_snn_order
)
# sample using VT and TN ---------------
source("sample_func_VT_TN.R")
locs <- locs_all
n <- nrow(locs_all)
n_samp <- 2
y_VT <- matrix(y_obs,
  nrow = length(y_obs),
  ncol = n_samp, byrow = FALSE
)
ret_obj <- sample_wrapper(0, 1, 0, 1, "VT")
y_VT[ret_obj$ind, ] <- ret_obj$samp
y_VT <- y_VT[, 1]

y_TN <- matrix(y_obs,
  nrow = length(y_obs),
  ncol = n_samp, byrow = FALSE
)
ret_obj <- sample_wrapper(0, 1, 0, 1, "TN")
y_TN[ret_obj$ind, ] <- ret_obj$samp
y_TN <- y_TN[, 1]
# read the sample generated by CSB ----------------
y_CB <- read.table(
  paste0(
    "samples/samp_cmp_known_CB_scene",
    scene_ID, ".csv"
  ),
  header = F, row.names = NULL
)[, 1]

zlim <- range(y_true, y_SNN, y_TN, y_VT, y_CB)

pdf(
  file = paste0("plots/sim_data_scene", scene_ID, "_true.pdf"),
  width = 5, height = 5
)
fields::image.plot(matrix(y_true, sqrt(n), sqrt(n)), zlim = zlim)
dev.off()

pdf(
  file = paste0(
    "plots/samp_cmp_known_SNN_scene", scene_ID, "_m", m,
    "_order", use_snn_order, ".pdf"
  ),
  width = 5, height = 5
)
fields::image.plot(matrix(y_SNN, sqrt(n), sqrt(n)), zlim = zlim)
dev.off()

pdf(
  file = paste0("plots/samp_cmp_known_VT_scene", scene_ID, ".pdf"),
  width = 5, height = 5
)
fields::image.plot(matrix(y_VT, sqrt(n), sqrt(n)), zlim = zlim)
abline(h = c(1, 2) / 3, lty = "dashed", lwd = 0.5)
abline(v = c(1, 2) / 3, lty = "dashed", lwd = 0.5)
dev.off()

pdf(
  file = paste0("plots/samp_cmp_known_TN_scene", scene_ID, ".pdf"),
  width = 5, height = 5
)
fields::image.plot(matrix(y_TN, sqrt(n), sqrt(n)), zlim = zlim)
abline(h = c(1, 2) / 3, lty = "dashed", lwd = 0.5)
abline(v = c(1, 2) / 3, lty = "dashed", lwd = 0.5)
dev.off()

pdf(
  file = paste0("plots/samp_cmp_known_CB_scene", scene_ID, ".pdf"),
  width = 5, height = 5
)
fields::image.plot(matrix(y_CB, sqrt(n), sqrt(n)), zlim = zlim)
dev.off()
